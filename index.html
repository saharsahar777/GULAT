<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>–ö–∞—Ä—Ç–∞ –¥–ª—è –ø—Ä–æ–≥—É–ª–æ–∫</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å—Ç–∏–ª–∏ OpenLayers -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: fixed;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            background: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0; /* –ó–∞–ø—Ä–µ—â–∞–µ–º —Å–∂–∏–º–∞—Ç—å—Å—è */
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        #map {
            flex: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç—ã */
        .map-control-btn {
            position: absolute;
            z-index: 1000;
            background: white;
            color: #333;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .map-control-btn:active {
            transform: scale(0.95);
        }

        .map-control-btn.primary {
            background: #667eea;
            color: white;
        }

        .map-control-btn.success {
            background: #48bb78;
            color: white;
        }

        .map-control-btn.loading {
            background: #999 !important;
            pointer-events: none;
        }

        #locationBtn {
            bottom: 24px;
            right: 16px;
        }

        #walkBtn {
            bottom: 24px;
            right: 88px;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .toast {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 24px;
            z-index: 2000;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            max-width: 80%;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞ —Ü–µ–ª–∏ */
        .destination-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ff4444;
            border: 4px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transform: translate(-50%, -50%);
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è */
        .current-location-marker {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4285F4;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transform: translate(-50%, -50%);
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–≥–æ—Ç–∏–ø OpenLayers –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) */
        .ol-attribution {
            font-size: 10px;
        }
        @media (max-width: 768px) {
            .ol-attribution button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –¥–ª—è –ø—Ä–æ–≥—É–ª–æ–∫</h1>
    </div>

    <div id="map"></div>

    <button class="map-control-btn success" id="walkBtn" title="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –ø—Ä–æ–≥—É–ª–∫–∏">
        üö∂
    </button>
    <button class="map-control-btn primary" id="locationBtn" title="–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">
        üìç
    </button>

    <div class="toast" id="toast"></div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É OpenLayers -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>
    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ OpenLayers
        let map;
        let userLocation = null;
        let userMarker = null;
        let destinationMarker = null;
        let walkRouteLine = null;
        let destinationPoint = null; // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ü–µ–ª–∏

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            setupEventListeners();
        });

        function initMap() {
            try {
                // 1. –°–æ–∑–¥–∞—ë–º —Å–ª–æ–∏
                // –°–ª–æ–π OpenStreetMap –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π
                const osmLayer = new ol.layer.Tile({
                    source: new ol.source.OSM()
                });

                // 2. –°–æ–∑–¥–∞—ë–º –≤–µ–∫—Ç–æ—Ä–Ω—ã–π —Å–ª–æ–π –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤ –∏ –ª–∏–Ω–∏–π
                const vectorSource = new ol.source.Vector();
                const vectorLayer = new ol.layer.Vector({
                    source: vectorSource
                });

                // 3. –°–æ–∑–¥–∞—ë–º –∫–∞—Ä—Ç—É —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –≤–∏–¥–æ–º –Ω–∞ –í–∞—Ä—à–∞–≤—É
                map = new ol.Map({
                    target: 'map',
                    layers: [osmLayer, vectorLayer],
                    view: new ol.View({
                        center: ol.proj.fromLonLat([21.0122, 52.2297]), // –í–∞—Ä—à–∞–≤–∞
                        zoom: 13,
                        maxZoom: 19
                    }),
                    controls: ol.control.defaults({
                        attributionOptions: {
                            collapsible: true // –°–≤–æ—Ä–∞—á–∏–≤–∞—é—â–∏–π—Å—è –±–ª–æ–∫ –∞—Ç—Ä–∏–±—É—Ü–∏–∏
                        }
                    })
                });

                console.log('‚úÖ –ö–∞—Ä—Ç–∞ OpenLayers —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
                setTimeout(() => getMyLocation(true), 1000);

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã OpenLayers:', error);
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã');
            }
        }

        function setupEventListeners() {
            document.getElementById('walkBtn').addEventListener('click', startWalk);
            document.getElementById('locationBtn').addEventListener('click', () => getMyLocation(false));
        }

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), duration);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (–¥–æ–ª–≥–æ—Ç–∞, —à–∏—Ä–æ—Ç–∞) –≤ —Ñ–æ—Ä–º–∞—Ç OpenLayers
        function lonLatToCoordinate(lonLatArray) {
            return ol.proj.fromLonLat(lonLatArray);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è (—Ñ–æ—Ä–º—É–ª–∞ –ì–∞–≤–µ—Ä—Å–∏–Ω–∞)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371000;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // --- –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
        function getMyLocation(silent = false) {
            if (!navigator.geolocation) {
                if (!silent) showToast('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                return;
            }

            const btn = document.getElementById('locationBtn');
            btn.classList.add('loading');
            btn.textContent = '‚è≥';

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    userLocation = { lat: lat, lon: lon };
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è OpenLayers
                    const userCoord = lonLatToCoordinate([lon, lat]);
                    
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –º–∞—Ä–∫–µ—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å
                    if (userMarker) {
                        map.getLayers().item(1).getSource().removeFeature(userMarker);
                    }
                    
                    // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä
                    userMarker = new ol.Feature({
                        geometry: new ol.geom.Point(userCoord)
                    });
                    
                    // –°—Ç–∏–ª–∏–∑—É–µ–º –º–∞—Ä–∫–µ—Ä
                    userMarker.setStyle(new ol.style.Style({
                        image: new ol.style.Circle({
                            radius: 12,
                            fill: new ol.style.Fill({ color: '#4285F4' }),
                            stroke: new ol.style.Stroke({ color: 'white', width: 3 })
                        })
                    }));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç—É (–≤–æ –≤—Ç–æ—Ä–æ–π —Å–ª–æ–π)
                    map.getLayers().item(1).getSource().addFeature(userMarker);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫—Ä—É–≥ —Ç–æ—á–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                    const accuracyCircle = new ol.Feature({
                        geometry: new ol.geom.Circle(userCoord, accuracy)
                    });
                    accuracyCircle.setStyle(new ol.style.Style({
                        stroke: new ol.style.Stroke({ color: '#4285F4', width: 1 }),
                        fill: new ol.style.Fill({ color: 'rgba(66, 133, 244, 0.1)' })
                    }));
                    map.getLayers().item(1).getSource().addFeature(accuracyCircle);
                    
                    // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                    map.getView().animate({
                        center: userCoord,
                        zoom: 16,
                        duration: 1000
                    });
                    
                    btn.classList.remove('loading');
                    btn.textContent = 'üìç';
                    
                    if (!silent) showToast('–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ!');
                },
                (error) => {
                    console.error('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error);
                    btn.classList.remove('loading');
                    btn.textContent = 'üìç';
                    
                    if (!silent) {
                        let errorMessage = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.';
                                break;
                            case error.TIMEOUT:
                                errorMessage = '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è.';
                                break;
                            default:
                                errorMessage = '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è.';
                        }
                        showToast(errorMessage, 4000);
                    }
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        }

        function startWalk() {
            if (!userLocation) {
                showToast('–°–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ');
                getMyLocation();
                return;
            }

            const walkBtn = document.getElementById('walkBtn');
            walkBtn.classList.add('loading');
            walkBtn.textContent = '‚è≥';

            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã
            clearPreviousWalk();

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ç–æ—á–∫—É –≤ —Ä–∞–¥–∏—É—Å–µ 500-2000 –º–µ—Ç—Ä–æ–≤
            const minDistance = 500;
            const maxDistance = 2000;
            const distance = minDistance + Math.random() * (maxDistance - minDistance);
            const angle = Math.random() * 2 * Math.PI;

            const deltaLat = (distance / 111000) * Math.cos(angle);
            const deltaLon = (distance / (111000 * Math.cos(userLocation.lat * Math.PI / 180))) * Math.sin(angle);

            const destLat = userLocation.lat + deltaLat;
            const destLon = userLocation.lon + deltaLon;
            
            destinationPoint = { lat: destLat, lon: destLon }; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

            const startCoord = lonLatToCoordinate([userLocation.lon, userLocation.lat]);
            const destCoord = lonLatToCoordinate([destLon, destLat]);

            // 1. –†–∏—Å—É–µ–º –º–∞—Ä—à—Ä—É—Ç (–ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è)
            walkRouteLine = new ol.Feature({
                geometry: new ol.geom.LineString([startCoord, destCoord])
            });
            walkRouteLine.setStyle(new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: '#ff4444',
                    width: 4,
                    lineDash: [10, 10]
                })
            }));

            // 2. –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä —Ü–µ–ª–∏
            destinationMarker = new ol.Feature({
                geometry: new ol.geom.Point(destCoord)
            });
            destinationMarker.setStyle(new ol.style.Style({
                image: new ol.style.Circle({
                    radius: 15,
                    fill: new ol.style.Fill({ color: '#ff4444' }),
                    stroke: new ol.style.Stroke({ color: 'white', width: 4 })
                })
            }));

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–∞ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π —Å–ª–æ–π
            const vectorSource = map.getLayers().item(1).getSource();
            vectorSource.addFeature(walkRouteLine);
            vectorSource.addFeature(destinationMarker);

            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ø–∞–ø –∫ –º–∞—Ä–∫–µ—Ä—É —Ü–µ–ª–∏
            const popupElement = createDestinationPopup(destLat, destLon);
            destinationMarker.set('popupContent', popupElement.innerHTML);

            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –≤–µ—Å—å –º–∞—Ä—à—Ä—É—Ç
            const extent = new ol.geom.LineString([startCoord, destCoord]).getExtent();
            map.getView().fit(extent, {
                padding: [60, 60, 60, 60],
                duration: 1000
            });

            // –°–æ–∑–¥–∞—ë–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞ —Ü–µ–ª–∏
            map.on('click', function(evt) {
                const feature = map.forEachFeatureAtPixel(evt.pixel, function(feature) {
                    return feature;
                });
                if (feature === destinationMarker) {
                    showDestinationPopup(destLat, destLon);
                }
            });

            walkBtn.classList.remove('loading');
            walkBtn.textContent = 'üö∂';

            // –í—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const actualDistance = calculateDistance(
                userLocation.lat, userLocation.lon,
                destLat, destLon
            );
            showToast(`–¶–µ–ª—å: ${Math.round(actualDistance)}–º –æ—Ç –≤–∞—Å!`);
        }

        function clearPreviousWalk() {
            const vectorSource = map.getLayers().item(1).getSource();
            if (walkRouteLine) {
                vectorSource.removeFeature(walkRouteLine);
                walkRouteLine = null;
            }
            if (destinationMarker) {
                vectorSource.removeFeature(destinationMarker);
                destinationMarker = null;
            }
        }

        function createDestinationPopup(lat, lon) {
            const distance = calculateDistance(userLocation.lat, userLocation.lon, lat, lon);
            const popupDiv = document.createElement('div');
            popupDiv.innerHTML = `
                <div style="font-family: sans-serif; padding: 8px; min-width: 220px;">
                    <b>üéØ –¢–æ—á–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</b><br>
                    –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ~${Math.round(distance)}–º<br>
                    –í—Ä–µ–º—è: ~${Math.round(distance / 80)} –º–∏–Ω<br>
                    <div style="margin-top: 10px; display: flex; flex-direction: column; gap: 6px;">
                        <button onclick="openRoute('yandex')" style="padding: 8px 12px; background: #FC3F1D; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">üó∫Ô∏è –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã</button>
                        <button onclick="openRoute('2gis')" style="padding: 8px 12px; background: #31AC45; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">üó∫Ô∏è 2GIS</button>
                        <button onclick="openRoute('google')" style="padding: 8px 12px; background: #4285F4; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">üó∫Ô∏è Google Maps</button>
                    </div>
                </div>
            `;
            return popupDiv;
        }

        function showDestinationPopup(lat, lon) {
            const popupElement = createDestinationPopup(lat, lon);
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ø–∞–ø–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Overlay
            // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º alert –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º toast
            showToast('–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ –≤ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–µ', 4000);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ –≤ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞—Ö (–æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        function openRoute(mapType) {
            if (!userLocation || !destinationPoint) {
                showToast('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç');
                return;
            }

            const start = `${userLocation.lat},${userLocation.lon}`;
            const end = `${destinationPoint.lat},${destinationPoint.lon}`;
            
            let url, mapName;
            
            switch(mapType) {
                case 'yandex':
                    url = `https://yandex.ru/maps/?rtext=${start}~${end}&rtt=pd`;
                    mapName = '–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞—Ö';
                    break;
                case '2gis':
                    url = `https://2gis.ru/routeSearch/rsType/pedestrian/from/${userLocation.lon},${userLocation.lat}/to/${destinationPoint.lon},${destinationPoint.lat}`;
                    mapName = '2GIS';
                    break;
                case 'google':
                default:
                    url = `https://www.google.com/maps/dir/?api=1&origin=${start}&destination=${end}&travelmode=walking`;
                    mapName = 'Google Maps';
                    break;
            }
            
            window.open(url, '_blank');
            showToast(`–ú–∞—Ä—à—Ä—É—Ç –æ—Ç–∫—Ä—ã—Ç –≤ ${mapName}`);
        }

        // –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
